---
title: Authentication
description: Understanding Hytale server authentication
---

import { Steps } from 'fumadocs-ui/components/steps';
import { Callout } from 'fumadocs-ui/components/callout';

# Authentication

Hytale servers require OAuth2 authentication to operate. This container implements the official [Server Provider Authentication Guide](https://support.hytale.com/hc/en-us/articles/45328341414043) for seamless, automated authentication.

## How It Works

The container uses **OAuth2 Device Code Flow** (RFC 8628) to authenticate with Hytale's servers. On first run, you'll authorize once, and tokens are automatically managed thereafter.

<Callout type="info">
**One auth, used everywhere** — The same OAuth token authenticates both the `hytale-downloader` (for server files) and the game server itself.
</Callout>

## Authentication Flow

<Steps>

### First Startup

When you start the container for the first time:
1. Container requests a device code from Hytale OAuth
2. A device authorization URL and code appear in the logs
3. You complete authorization in your browser
4. Tokens are saved and used for all subsequent operations

### Token Usage

After authorization, tokens are used to:
- Download server files via `hytale-downloader`
- Create game sessions for the server
- Authenticate the server with Hytale's services

### Automatic Refresh

Tokens are automatically refreshed before they expire:
- **OAuth Access Token**: 1 hour (refreshed 5 min before expiry)
- **OAuth Refresh Token**: 30 days
- **Game Session**: 1 hour (refreshed 5 min before expiry)

### Subsequent Restarts

On restart, the container:
1. Loads existing tokens from storage
2. Refreshes if needed
3. Creates a new game session
4. Starts the server with valid tokens

</Steps>

## Authentication Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         STARTUP FLOW                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. Load existing tokens (if any)                                           │
│     └─► /server/.hytale/tokens/                                             │
│                                                                             │
│  2. If no tokens OR expired → Device Code Flow                              │
│     ├─► POST /oauth2/device/auth                                            │
│     ├─► Display URL + code to user                                          │
│     ├─► Poll /oauth2/token until authorized                                 │
│     └─► Save tokens                                                         │
│                                                                             │
│  3. Write credentials for hytale-downloader                                 │
│     └─► /server/.cache/.hytale-downloader-credentials.json                  │
│                                                                             │
│  4. Download server files (uses saved credentials)                          │
│                                                                             │
│  5. Create game session                                                     │
│     ├─► GET /my-account/get-profiles                                        │
│     └─► POST /game-session/new → sessionToken + identityToken               │
│                                                                             │
│  6. Start server with tokens                                                │
│     └─► --session-token "..." --identity-token "..."                        │
│                                                                             │
│  7. Background daemon refreshes tokens before expiry                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Viewing Authentication Status

Check authentication in the logs:

```bash
docker compose logs hytale | grep -i auth
```

**Success indicators:**
- ✅ `"OAuth tokens saved"` - Initial auth completed
- ✅ `"Using existing OAuth token"` - Tokens loaded from storage
- ✅ `"OAuth token refreshed"` - Token refresh successful
- ✅ `"Game session created"` - Server ready to accept connections

**Action needed:**
- ⏳ `"DEVICE AUTHORIZATION REQUIRED"` - Check logs for URL and complete auth

## Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `AUTO_REFRESH_TOKENS` | `true` | Automatically refresh tokens before expiry |
| `AUTOSELECT_GAME_PROFILE` | `true` | Auto-select first profile if account has multiple |
| `HYTALE_SERVER_SESSION_TOKEN` | (empty) | Pre-provided session token (hosting providers) |
| `HYTALE_SERVER_IDENTITY_TOKEN` | (empty) | Pre-provided identity token (hosting providers) |

## Profile Selection

If your Hytale account has multiple game profiles, you can control which one the server uses.

### Automatic Selection (Default)

With `AUTOSELECT_GAME_PROFILE=true`, the first profile is automatically selected.

### Manual Selection

Set `AUTOSELECT_GAME_PROFILE=false` to choose which profile to use:

```yaml
environment:
  AUTOSELECT_GAME_PROFILE: "false"
```

On startup, you'll see:

```
═══════════════════════════════════════════════════════════
  PROFILE SELECTION REQUIRED
═══════════════════════════════════════════════════════════
  Multiple profiles found. Select one to continue:

  1. PlayerOne (a1b2c3d4...)
  2. AltAccount (e5f6g7h8...)

  Run: hytale-auth profile select <number>
═══════════════════════════════════════════════════════════
```

Select a profile:

```bash
docker exec -it hytale-server hytale-auth profile select 1
```

<Callout type="info">
Your profile selection is saved and persists across restarts.
</Callout>

## Token Storage

Tokens are stored in the `/server/.hytale/tokens/` directory (persisted in the `hytale-data` volume):

| File | Purpose |
|------|---------||
| `/server/.hytale/tokens/oauth_tokens.json` | OAuth access & refresh tokens |
| `/server/.hytale/tokens/session_tokens.json` | Game session tokens |
| `/server/.hytale/tokens/profiles.json` | Cached user profiles |
| `/server/.hytale/tokens/selected_profile.json` | Currently selected profile |
| `/server/.cache/.hytale-downloader-credentials.json` | Credentials for downloader |

<Callout type="info">
Tokens are automatically persisted in the `hytale-data` volume across container restarts.
</Callout>

## Authentication CLI

The container includes a CLI tool for manual token management:

```bash
# Inside container
docker exec -it hytale-server hytale-auth status
docker exec -it hytale-server hytale-auth login
docker exec -it hytale-server hytale-auth profile list
docker exec -it hytale-server hytale-auth profile select 1
docker exec -it hytale-server hytale-auth session
docker exec -it hytale-server hytale-auth logout
```

| Command | Description |
|---------|-------------|
| `hytale-auth login` | Start device code authentication |
| `hytale-auth refresh` | Refresh OAuth tokens |
| `hytale-auth session` | Create a new game session |
| `hytale-auth profile list` | List available game profiles |
| `hytale-auth profile select <n>` | Select profile by number or UUID |
| `hytale-auth status` | Show current token status |
| `hytale-auth export` | Export tokens as environment variables |
| `hytale-auth logout` | Clear all stored tokens |

## For Hosting Providers

If you manage tokens externally (e.g., for multi-server deployments), pass them via environment variables:

```yaml
environment:
  HYTALE_SERVER_SESSION_TOKEN: "eyJhbGciOi..."
  HYTALE_SERVER_IDENTITY_TOKEN: "eyJhbGciOi..."
```

The container will skip the OAuth flow and use these tokens directly.

<Callout type="warn">
Session tokens expire in 1 hour. Your external system must refresh and restart containers with new tokens.
</Callout>

## Troubleshooting

### "Download failed" after auth success

Tokens may not be in the correct format for `hytale-downloader`. Check:
```bash
docker exec -it hytale-server cat /server/.cache/.hytale-downloader-credentials.json
```

### Tokens keep expiring

Tokens are stored in `/server/.hytale/tokens/` and automatically persisted in the `hytale-data` volume. If tokens are not persisting, check:

```bash
docker exec hytale-server ls -la /server/.hytale/tokens/
```

### Need to re-authenticate

```bash
docker exec -it hytale-server hytale-auth logout
docker compose restart
```

### Device code expires (15 minutes)

Complete authorization faster, or restart to get a new code:
```bash
docker compose restart
docker compose logs -f
```

## API Reference

The container implements these Hytale OAuth2 endpoints:

| Endpoint | Purpose |
|----------|---------|
| `POST /oauth2/device/auth` | Request device code |
| `POST /oauth2/token` | Exchange/refresh tokens |
| `GET /my-account/get-profiles` | Get user profiles |
| `POST /game-session/new` | Create game session |
| `POST /game-session/refresh` | Refresh game session |
| `DELETE /game-session` | Terminate session |

Base URLs:
- OAuth: `https://oauth.accounts.hytale.com`
- Account: `https://account-data.hytale.com`
- Sessions: `https://sessions.hytale.com`

## Next Steps

- [Configure your server](/docs/configuration)
- [Troubleshooting guide](/docs/troubleshooting)
